<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Etkinlik Detayları</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/eventDetails_style.css') }}">
</head>
<body>
        {% include 'header.html' %}

    <main>
        <div class="details-and-chat">
            <section class="event-details">
                <div class="edit-button">
                    <a href="{{ url_for('edit_event', event_id=event['id']) }}" class="edit-link"> ✏️ </a>
                </div>

                <h2 class="event-title"> {{ event['event_name'] }} <span class="event-category">{{ event['category'] }}</span></h2>

                <div class="event-info">
                    <div class="event-date">
                        <p><strong>Başlangıç:</strong> {{ event['startDate'] }} / {{ event['startTime'] }}</p>
                        <p><strong>Bitiş:</strong> {{ event['finishDate'] }} / {{ event['finishTime'] }}</p>
                        <p><strong>Süre:</strong> 7 saat</p>
                    </div>

                    <div class="event-location">
                        <p><strong>Konum:</strong> {{ event['city'] }} - {{ event['address'] }} </p>
                    </div>
                </div>

                <div class="event-description">
                    <h3>Açıklama:</h3>
                    <p>{{ event['description'] }}</p>
                </div>

                <div class="event-creator">
                    <p><strong>Oluşturan:</strong> {{ event['creator_username'] }} </p>
                </div>

                <div class="event-actions">
                    <form action="{{ url_for('join_event', event_id=event['id']) }}" method="POST">
                        <button type="submit" class="join-button">Etkinliğe Katıl</button>
                    </form>
                </div>
            </section>

            <section class="event-chat">
                <h3>Event Chat</h3>
                <div id="chat-container">
                    <div id="chat-messages">
                    </div>
                    <textarea id="chat-input" placeholder="Mesajınızı yazın..."></textarea>
                    <button id="send-message">Gönder</button>
                </div>
            </section>
        </div>
    </main>

    <footer>
        <p>© 2024 Etkinlik Planlama Platformu. Tüm Hakları Saklıdır.</p>
    </footer>

    <script>
        const eventId = {{ event['id'] }};
        const userName = "{{ username }}";

        document.getElementById("send-message").addEventListener("click", async () => {
            const input = document.getElementById("chat-input");
            const content = input.value.trim();
            if (!content) return;

            try {
                const response = await fetch(`/send_message/${eventId}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ content }),
                });

                if (response.ok) {
                    const message = await response.json();
                    displayMessage({
                        timestamp: message.timestamp,
                        user_name: message.user_name,
                        content: message.content,
                    });
                    input.value = "";
                } else {
                    alert("Mesaj gönderilemedi.");
                }
            } catch (error) {
                console.error("Mesaj gönderme hatası:", error);
                alert("Mesaj gönderilemedi.");
            }
        });

        function displayMessage(message) {
            const messagesContainer = document.getElementById("chat-messages");
            const messageEl = document.createElement("div");
            messageEl.textContent = `[${message.timestamp}] ${message.user_name} : ${message.content}`;
            messagesContainer.appendChild(messageEl);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
    </script>
</body>
</html>

